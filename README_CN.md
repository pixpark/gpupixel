<h1 align="center">
  <a href="https://github.com/pixpark/gpupixel"><img src="./docs/image/describe.png"></a>
</h1>

<p align="center">
  <a href="./README.md">English</a> |
  <a href="./README_CN.md">ç®€ä½“ä¸­æ–‡</a>
</p>

<p align="center">
   <a href="https://github.com/pixpark/gpupixel/stargazers"><img alt="GPUPixel Stars" src="https://img.shields.io/github/stars/pixpark/gpupixel?style=social"/></a>
    <a href="https://github.com/pixpark/gpupixel/releases/latest"><img alt="GPUPixel Release" src="https://img.shields.io/github/v/release/pixpark/gpupixel"/></a>
    <a href="#"><img alt="GPUPixel Stars" src="https://img.shields.io/badge/Platform-iOS_%7C_Android_%7C_Mac_%7C_Win_%7C_Linux-red"/></a>
    <a href="https://github.com/pixpark/gpupixel/blob/main/LICENSE"><img alt="GPUPixel Stars" src="https://img.shields.io/github/license/pixpark/gpupixel"/></a>
</p>

---
> æ¬¢è¿å¤§å®¶åŠ å…¥ä½¿å¾— GPUPixel æ›´å¥½ï¼Œé€šè¿‡è®¨è®º [discussions](https://github.com/pixpark/gpupixel/discussions), æäº¤ [issues](https://github.com/pixpark/gpupixel/issues/new/choose), æäº¤ [PRs](https://github.com/pixpark/gpupixel/pulls).

> ğŸ“¢ äººè„¸å…³é”®ç‚¹æ£€æµ‹ä» v1.2.0å¼€å§‹å·²ç»ç”± Face++ æ›¿æ¢ä¸º VNN, ä¸éœ€è¦è”ç½‘è®¤è¯ï¼ˆä¸éœ€è¦äº¤é’±äº†ï¼‰ï¼Œå¹¶ä¸”æ”¯æŒäº†å…¨ç«¯ï¼Œæ¬¢è¿å„ä½å®¢è§‚å“å°é£Ÿç”¨ ğŸ‘

## ç®€ä»‹ ##

â›°ï¸ GPUPixelæ˜¯ä¸€ä¸ªä½¿ç”¨C++11ç¼–å†™çš„é«˜æ€§èƒ½å›¾åƒå’Œè§†é¢‘AIç¾é¢œæ•ˆæœåº“ï¼Œéå¸¸å®¹æ˜“ç¼–è¯‘å’Œé›†æˆï¼Œå¹¶ä¸”åº“æ–‡ä»¶éå¸¸å°ã€‚

ğŸ”‘ å®ƒæ˜¯åŸºäºGPUçš„ï¼Œå¹¶ä¸”å¸¦æœ‰å†…ç½®çš„ç¾é¢œæ•ˆæœæ»¤é•œï¼Œå¯ä»¥å®ç°å•†ä¸šçº§åˆ«çš„æ•ˆæœã€‚

ğŸ”Œ å®ƒæ”¯æŒçš„å¹³å°åŒ…æ‹¬iOSã€Macå’ŒAndroidï¼Œç†è®ºä¸Šå¯ä»¥ç§»æ¤åˆ°ä»»ä½•æ”¯æŒOpenGL/ESçš„å¹³å°ã€‚


## æ•ˆæœ
ğŸ‘‰ **è§†é¢‘: <a href="https://youtu.be/9BY1Qx1NEPs" target="_blank">YouTube</a> | <a href="https://www.bilibili.com/video/BV1xQ4y1L7Fh/?share_source=copy_web&vd_source=46adcb1014fa989cfcbb4cc1e866831e" target="_blank">BiliBili</a>**


|              **åŸå›¾**              |                **ç£¨çš®**                |               **ç¾ç™½**               |              **ThinFace**              |
| :--------------------------------: | :------------------------------------: | :----------------------------------: | :------------------------------------: |
| ![origin](./docs/image/origin.gif) |   ![smooth](./docs/image/smooth.gif)   |   ![white](./docs/image/white.gif)   | ![thinface](./docs/image/thinface.gif) |
|              **å¤§çœ¼**              |                **å£çº¢**                |               **è…®çº¢**               |                  **å¼€                  | å…³** |
| ![bigeye](./docs/image/bigeye.gif) | ![lipstick](./docs/image/lipstick.gif) | ![blusher](./docs/image/blusher.gif) |   ![on-off](./docs/image/on-off.gif)   |
 
## æ¶æ„æµç¨‹
![](./docs/arch-zh.jpg)
 
## ç‰¹æ€§å¯¹æ¯”

âœ…: æ”¯æŒ | âŒ: ä¸æ”¯æŒ | âœï¸: è®¡åˆ’ä¸­

|                   | [GPUPixel](https://github.com/pixpark/gpupixel) | [GPUImage](https://github.com/BradLarson/GPUImage) |
| :---------------- | :---------------------------------------------: | :------------------------------------------------: |
| ğŸ**æ»¤é•œ:**        |                        âœ…                        |                         âŒ                          |
| ç£¨çš®              |                        âœ…                        |                         âŒ                          |
| ç¾ç™½              |                        âœ…                        |                         âŒ                          |
| ç˜¦è„¸              |                        âœ…                        |                         âŒ                          |
| å¤§çœ¼              |                        âœ…                        |                         âŒ                          |
| å£çº¢              |                        âœ…                        |                         âŒ                          |
| è…®çº¢              |                        âœ…                        |                         âŒ                          |
| å†…å»ºæ»¤é•œ          |                        âœ…                        |                         âœ…                          |
| ğŸ“**è¾“å…¥æ ¼å¼ï¼š**   |                                                 |                                                    |
| YUV420P(I420)     |                        âœ…                        |                         âŒ                          |
| RGBA              |                        âœ…                        |                         âœ…                          |
| JPEG              |                        âœ…                        |                         âœ…                          |
| PNG               |                        âœ…                        |                         âœ…                          |
| NV21(for Android) |                        âœï¸                        |                         âŒ                          |
| ğŸ‰**è¾“å‡ºæ ¼å¼ :**   |                                                 |                                                    |
| RGBA              |                        âœ…                        |                         âœ…                          |
| YUV420P(I420)     |                        âœ…                        |                         âŒ                          |
| ğŸ¥‘**å¹³å°ç³»ç»Ÿ:**    |                                                 |                                                    |
| iOS               |                        âœ…                        |                         âœ…                          |
| Mac               |                        âœ…                        |                         âœ…                          |
| Android           |                        âœ…                        |                         âŒ                          |
| Win               |                        âœ…                        |                         âŒ                          |
| Linux             |                        âœ…                        |                         âŒ                          |


## ç³»ç»Ÿæœ€ä½ç‰ˆæœ¬
|           OS           |  iOS  |  OSX  |   Android    | Windows | Linux |
| :--------------------: | :---: | :---: | :----------: | :-----: | :---: |
| Min Support OS Version | 10.0  | 10.13 | 5.0 (API 21) |    -    |   -   |

##  æ€§èƒ½
### iPhone
|       -        | iPhone 6P | iPhone 8 | iPhone X | iPhone 11 | iPhone 14 pro |
| :------------: | :-------: | :------: | :------: | :-------: | :-----------: |
|    **CPU**     |    5%     |    5%    |    3%    |    3%     |      3%       |
| **Time Taken** |   10ms    |   4ms    |   3ms    |    3ms    |      3ms      |
### Android
|     -      | Xiaomi 10 | Huawei Mate30 | Vivo  | SAMSUNG | Google Pixel |
| :--------: | :-------: | :-----------: | :---: | :-----: | :----------: |
|    CPU     |    3%     |      5%       |   -   |    -    |      -       |
| Time Taken |    6ms    |      5ms      |   -   |    -    |      -       |
 
## åº“ä½“ç§¯

|       | iOS(.framework) | MacOS(.framework) | Android(.aar) |
| :---: | :-------------: | :---------------: | :-----------: |
| Size  |     2.4 MB      |      2.6 MB       |    2.1 MB     |

 
## å¼€å§‹ä¹‹å‰
â­ï¸ è€é“ç»™ä¸ªæ˜Ÿæ˜Ÿï¼Œæ±‚ç‚¹èµ!

![](./docs/image/give-star.gif)

 
## å¿«é€Ÿå¼€å§‹

### å¦‚ä½•ç¼–è¯‘
ä» v1.1.0å¼€å§‹ä½¿ç”¨ cmake ç¼–è¯‘, è¯·è‡ªè¡Œæœç´¢ä¸‹cmakeçš„å®‰è£…é…ç½®. 
åº“å’Œç”Ÿæˆçš„ demo ç¨‹åºä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•çš„ output ç›®å½•
 
### iOS 

```shell
# Generate project
## for iOS arm64
cmake -G Xcode -B build -S src -DCMAKE_TOOLCHAIN_FILE=toolchain/ios.toolchain.cmake -DPLATFORM=OS64
 
# Build
cmake --build build --config Debug #or Release
```
### Mac

```shell
# Generate project
## for Mac Apple Silicon
cmake -G Xcode -B build -S src -DCMAKE_TOOLCHAIN_FILE=toolchain/ios.toolchain.cmake -DPLATFORM=MAC_ARM64
## for Mac Intel
cmake -G Xcode -B build -S src -DCMAKE_TOOLCHAIN_FILE=toolchain/ios.toolchain.cmake -DPLATFORM=MAC

# Build
cmake --build build --config Debug #or Release
```

### Android
Open the directory `src/android/java` in Android Studio.

### Windows
éœ€æå‰å®‰è£… Cmake and MinGW64
```shell
# Generate project
cmake -G "MinGW Makefiles" -B build -S src

# Build
cmake --build build -DCMAKE_BUILD_TYPE=Debug #or Release
```
### Linux (Test on ubuntu)

```shell
# install cmake 
sudo apt-get install cmake pkg-config
# install dependent lib
sudo apt-get install mesa-utils libglu1-mesa-dev freeglut3-dev mesa-common-dev libglfw3-dev

# Generate project
cmake -B build -S src

# Build
cmake --build build -DCMAKE_BUILD_TYPE=Debug #or Release 
```

## App demo
 
### iOS and Mac
å‚è€ƒ `examples/ios` and `examples/mac`
### Android
å‚è€ƒ  `src/android/java`
### Window and Linux

å‚è€ƒ  `examples/desktop` 

```shell
# Generate project
cmake -G "MinGW Makefiles" -B examples/build -S examples

# Build
cmake --build build -DCMAKE_BUILD_TYPE=Debug #or Release 
```
#### App ä½¿ç”¨ 
<kbd>A</kbd> <kbd>S</kbd> <kbd>D</kbd> <kbd>F</kbd> <kbd>G</kbd> <kbd>H</kbd> - å¢åŠ  smooth, white, thin face, big eye, lipstick, blusher çš„å€¼.

<kbd>Z</kbd> <kbd>X</kbd> <kbd>C</kbd> <kbd>V</kbd> <kbd>B</kbd> <kbd>N</kbd> - å‡å° smooth, white, thin face, big eye, lipstick, blusher çš„å€¼. 

## C++ æ¥å£è°ƒç”¨
**å£°æ˜ filters**

```c++
// video data input
std::shared_ptr<SourceRawDataInput> source_raw_input_;
// beauty filter
std::shared_ptr<BeautyFaceFilter> beauty_face_filter_;
// video data output 
std::shared_ptr<TargetRawDataOutput> target_raw_output_;
```
**åˆ›å»ºå’Œä¸²è” filters**

```c++
 gpupixel::GPUPixelContext::getInstance()->runSync([&] {
    // Create filter
    source_raw_input_ = SourceRawDataInput::create();
    target_raw_output_ = TargetRawDataOutput::create();
    // Face Beauty Filter
    beauty_face_filter_ = BeautyFaceFilter::create();
    
    // Add filter
    source_raw_input_->addTarget(beauty_face_filter_)
                     ->addTarget(target_raw_output_);
 }
```

**è¾“å…¥ YUV420P æˆ– RGBAæ•°æ®**

```c++
// ...
// YUVI420
 source_raw_input_->uploadBytes(width,
                                height, 
                                bufferY,
                                strideY, 
                                bufferU, 
                                strideU,
                                bufferV, 
                                strideV);
// ...
// bytes: RGBA data
 source_raw_input_->uploadBytes(bytes,
                                width, 
                                height, 
                                stride);
```

**è·å–è¾“å‡ºæ•°æ®**

```c++
// I420 callback
target_raw_output_->setI420Callbck([=](const uint8_t *data, 
                                        int width, 
                                        int height, 
                                        int64_t ts) {
    size_t y_size = width * height;
    const uint8_t *uData = data + y_size;
    const uint8_t *vData = data + y_size + y_size / 4;
    // Do something you want
});

// RGBA callback->
target_raw_output_->setPixelsCallbck([=](const uint8_t *data, 
                                        int width, 
                                        int height, 
                                        int64_t ts) {
    size_t rgba_size = width * height*4;
    // Do something you want
});

// Output data callbck
```
 

## Star History

[![Star History Chart](https://api.star-history.com/svg?repos=pixpark/gpupixel&type=Date)](https://star-history.com/#pixpark/gpupixel&Date)

## å‚ä¸è´¡çŒ®
æ¬¢è¿å‚ä¸æ­¤é¡¹ç›®ï¼Œè´¡çŒ®ä»£ç ï¼ŒåŒæ—¶å¸Œæœ›é€šè¿‡åœ¨ç¤¾äº¤åª’ä½“åˆ†äº« GPUPixel é¡¹ç›®æ¥æ”¯æŒæœ¬é¡¹ç›®  ğŸ‘ğŸ».


## æ„Ÿè°¢
### å‚è€ƒé¡¹ç›®
1. [GPUImage](https://github.com/BradLarson/GPUImage) 
2. [CainCamera](https://github.com/CainKernel/CainCamera)
3. [AwemeLike](https://github.com/ZZZZou/AwemeLike)
4. [VNN](https://github.com/joyycom/VNN)

## License
This repository is available under the [MIT License](https://github.com/pixpark/gpupixel?tab=MIT-1-ov-file#readme).

